"use strict";var __rest=this&&this.__rest||function(e,t){var r={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(r[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(r[a[o]]=e[a[o]])}return r},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ColorPicker=void 0;const react_1=__importDefault(require("react")),popover2_1=require("@blueprintjs/popover2"),core_1=require("@blueprintjs/core"),core_2=require("@blueprintjs/core"),react_color_1=require("react-color"),styled_1=__importDefault(require("../utils/styled")),gradient_1=require("../utils/gradient"),DEFAULT_COLORS=["#D0021B","#F5A623","#F8E71C","#8B572A","#7ED321","#417505","#BD10E0","#9013FE","#4A90E2","#50E3C2","#B8E986","#000000","#4A4A4A","#9B9B9B","#FFFFFF"].reverse(),getUsedColors=e=>{const t=[];e.pages.forEach((e=>{e.children.forEach((e=>{"text"===e.type&&t.push(e.fill),"svg"===e.type&&t.push(...e.colorsReplace.values())}))}));const r=[];return t.forEach((e=>{if((0,gradient_1.isGradient)(e)){const[t,a,o]=(0,gradient_1.parseColor)(e);r.push(a,o)}else r.push(e)})),[...new Set(r)]},SolidContainer=(0,styled_1.default)("div")`
  padding: 5px;

  & .sketch-picker {
    padding: 0px !important;
    box-shadow: none !important;
    background: none !important;
  }

  & .flexbox-fix {
    border-top: none !important;
  }

  .bp4-dark & .sketch-picker {
    background-color: #394b59;
  }

  .bp4-dark & .sketch-picker label {
    color: #f5f8fa !important;
  }
`,SolidInput=e=>{var{style:t,color:r,onChange:a}=e,o=__rest(e,["style","color","onChange"]);const[n,l]=react_1.default.useState(r);react_1.default.useEffect((()=>{l(r)}),[r]);const i=react_1.default.useRef(),c=react_1.default.useRef();return react_1.default.createElement(SolidContainer,{style:t,onMouseDown:e=>{"INPUT"!==e.target.tagName&&e.preventDefault()}},react_1.default.createElement(react_color_1.SketchPicker,Object.assign({color:n},o,{onChange:e=>{const{r:t,g:r,b:o,a:n}=e.rgb,s=`rgba(${t},${r},${o},${n})`;l(s),c.current=s,i.current||(i.current=window.setTimeout((()=>{i.current=0,a(s)}),50))}})))},LinearGradient=({value:e,onChange:t,store:r})=>{const[a,o,n]=(0,gradient_1.parseColor)(e);return react_1.default.createElement("div",null,react_1.default.createElement("div",{style:{width:"200px",height:"150px"}},react_1.default.createElement("div",{style:{height:"100%",background:e}})),react_1.default.createElement("div",{style:{display:"flex",paddingBottom:"20px",paddingTop:"20px",justifyContent:"space-between"}},react_1.default.createElement(exports.ColorPicker,{value:o,onChange:e=>{t(`linear-gradient(${a}deg,${e},${n})`)},store:r,style:{margin:""}}),react_1.default.createElement(exports.ColorPicker,{value:n,onChange:e=>{t(`linear-gradient(${a}deg,${o},${e})`)},store:r,style:{margin:""}})),react_1.default.createElement("div",{style:{padding:"10px"}},react_1.default.createElement(core_2.Slider,{min:0,max:360,value:a,showTrackFill:!1,labelRenderer:!1,onChange:e=>{t(`linear-gradient(${e}deg,${o},${n})`)}})))},VariantColorInput=({value:e,onChange:t,preset:r,store:a})=>{const[o,n]=react_1.default.useState((0,gradient_1.isGradient)(e)?"gradient":"solid");return react_1.default.createElement("div",{style:{padding:"5px"}},react_1.default.createElement(core_1.Tabs,{id:"TabsExample",selectedTabId:o,onChange:e=>n(e)},react_1.default.createElement(core_1.Tab,{id:"solid",title:"Solid",panel:react_1.default.createElement(SolidInput,{color:e,onChange:t,presetColors:r,style:{padding:"0"}})}),react_1.default.createElement(core_1.Tab,{id:"gradient",title:"Linear",panel:react_1.default.createElement(LinearGradient,{value:e,onChange:t,store:a}),panelClassName:"ember-panel"})))},ColorPicker=({value:e,onChange:t,size:r,store:a,gradientEnabled:o,children:n,style:l})=>{const i=r||30,c=a?getUsedColors(a).slice(0,8):[],s=c.concat(DEFAULT_COLORS.slice(0,16-c.length).reverse());return react_1.default.createElement(popover2_1.Popover2,{autoFocus:!1,enforceFocus:!0,interactionKind:"hover",content:o?react_1.default.createElement(VariantColorInput,{preset:s,value:e,onChange:t,store:a}):react_1.default.createElement(SolidInput,{color:e,onChange:t,presetColors:s})},react_1.default.createElement("div",{onMouseDown:e=>e.preventDefault(),style:Object.assign({width:i+"px",height:i+"px",background:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='15' height='15' viewBox='0 0 8 8'%3E%3Cg fill='rgba(112, 112, 116, 1)' fill-opacity='1'%3E%3Cpath fill-rule='evenodd' d='M0 0h4v4H0V0zm4 4h4v4H4V4z'/%3E%3C/g%3E%3C/svg%3E\")",marginLeft:"10px",borderRadius:"2px",boxShadow:"0 0 2px grey",marginBottom:"-4px"},l)},react_1.default.createElement("div",{style:{width:i+"px",height:i+"px",background:e}},n)))};exports.ColorPicker=ColorPicker,exports.default=exports.ColorPicker;